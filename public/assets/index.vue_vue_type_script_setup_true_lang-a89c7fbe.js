import{d as V,a5 as q,o as l,c as r,a as u,A as b,t as A,u as e,F as E,s as ne,f as s,_ as d,C as K,i as Q,v as f,w as $,q as ie,l as Y,I as J,Y as ce,m as X,k as Z,r as S,b as v,p as U,e as re,a3 as ue,ae as de,n as pe,Q as fe,z as P,K as O,bd as ye,be as he,P as me}from"./index-6bc7e56b.js";import{N as _e}from"./Popconfirm-d4eb8252.js";import{N as H}from"./NumberAnimation-47c3dc17.js";import{N as ke}from"./LayoutSider-eab6d7f3.js";function ve(L,w){let C;return(...x)=>{const c=()=>{clearTimeout(C),L(...x)};clearTimeout(C),C=setTimeout(c,w)}}const be={class:"mb-2 text-xs text-neutral-400 font-bold"},xe={class:"ml-1"},ge=["onClick"],Se={class:"relative flex-1 overflow-hidden break-all text-ellipsis whitespace-nowrap"},we={key:1},Ce={key:0,class:"absolute z-10 flex visible right-1"},Ie=["onClick"],$e={class:"p-1"},De={key:0,class:"p-1"},Te={class:"p-1"},R=V({__name:"ListItem",props:{dataSources:null,title:null},emits:["update","delete","sticky","select"],setup(L,{emit:w}){const C=L,x=C.dataSources,c=q();async function h(n){w("select",n)}function B(n,o,p){p==null||p.stopPropagation(),n.isEdit=o}async function m(n,o){o==null||o.stopPropagation(),await c.updateGroupInfo({isSticky:!n.isSticky,groupId:n.uuid}),await c.queryMyGroup()}async function g(n,o){o==null||o.stopPropagation(),w("delete",n)}const _=ve(g,600);async function y(n){const{uuid:o,title:p}=n;n.isEdit=!1,await c.updateGroupInfo({groupId:o,title:p}),await c.queryMyGroup()}async function D(n,o){o==null||o.stopPropagation(),o.key==="Enter"&&y(n)}function N(n,o){o==null||o.stopPropagation(),y(n)}function G(n){return c.active===n}return(n,o)=>{var p;return l(),r(E,null,[u("p",be,[b(A(C.title)+" ",1),u("span",xe,"("+A((p=e(x))==null?void 0:p.length)+")",1)]),(l(!0),r(E,null,ne(e(x),a=>(l(),r("div",{key:`${a.uuid}`},[u("a",{class:ie(["relative flex items-center gap-3 px-3 py-2.5 break-all border rounded-md cursor-pointer hover:bg-neutral-100 group dark:border-neutral-800 dark:hover:bg-[#24272e]",G(a.uuid)&&["border-[#3076FD]","bg-neutral-100","text-[#3076FD]","dark:bg-[#24272e]","dark:border-[#3076fd]","pr-20"]]),onClick:i=>h(a)},[u("span",null,[s(e(d),{icon:a.isSticky?"ri:pushpin-2-line":a.appId?"icon-park-outline:application-one":"ri:message-3-line"},null,8,["icon"])]),u("div",Se,[a.isEdit?(l(),K(e(Q),{key:0,value:a.title,"onUpdate:value":i=>a.title=i,size:"tiny",onKeypress:i=>D(a,i)},null,8,["value","onUpdate:value","onKeypress"])):(l(),r("span",we,A(a.title),1))]),G(a.uuid)?(l(),r("div",Ce,[a.isEdit?(l(),r("button",{key:0,class:"p-1",onClick:i=>N(a,i)},[s(e(d),{icon:"ri:save-line"})],8,Ie)):(l(),r(E,{key:1},[u("button",$e,[s(e(d),{icon:a.isSticky?"ri:unpin-line":"ri:pushpin-line",onClick:i=>m(a,i)},null,8,["icon","onClick"])]),a.appId?f("",!0):(l(),r("button",De,[s(e(d),{icon:"ri:edit-line",onClick:i=>B(a,!0,i)},null,8,["onClick"])])),s(e(_e),{placement:"bottom",onPositiveClick:i=>e(_)(a,i)},{trigger:$(()=>[u("button",Te,[s(e(d),{icon:"ri:delete-bin-line"})])]),default:$(()=>[b(" "+A(n.$t("chat.deleteHistoryConfirm")),1)]),_:2},1032,["onPositiveClick"])],64))])):f("",!0)],10,ge)]))),128))],64)}}}),Ae={class:"flex flex-col gap-3 text-sm"},Ge={key:0,class:"flex flex-col items-center mt-4 text-center text-neutral-300"},Me=V({__name:"List",setup(L){const{isMobile:w}=Y(),C=J(),x=ce(),c=X(),h=q(),B=Z(),m=S(100),g=v(()=>h.groupList),_=v(()=>h.groupKeyWord);U(g,()=>m.value=m.value+1),U(_,()=>m.value=m.value+1),v(()=>B.isLogin);function y(t){const z=new Date(t).getTime()+8*60*60*1e3;return new Date(z).getTime()}const D=new Date().setHours(0,0,0,0),N=v(()=>g.value.filter(t=>_.value?t.title.includes(_.value)&&t.isSticky:t.isSticky)),G=v(()=>g.value.filter(t=>_.value?t.title.includes(_.value)&&!t.isSticky&&t.appId:!t.isSticky&&t.appId)),n=v(()=>g.value.filter(t=>_.value?t.title.includes(_.value)&&!t.isSticky&&!t.appId&&y(t.createdAt)>=D:!t.isSticky&&!t.appId&&y(t.createdAt)>=D)),o=v(()=>g.value.filter(t=>_.value?t.title.includes(_.value)&&!t.isSticky&&!t.appId&&y(t.createdAt)<D:!t.isSticky&&!t.appId&&y(t.createdAt)<D));async function p(t){const{uuid:M}=t;i(M)||(await h.setActiveGroup(M),x.name!=="Chat"&&C.push("/chat"),w.value&&c.setSiderCollapsed(!0))}async function a(t){event==null||event.stopPropagation(),await h.deleteGroup(t),await h.queryMyGroup(),w.value&&c.setSiderCollapsed(!0)}function i(t){return h.active===t}return re(()=>{h.queryMyGroup()}),(t,M)=>(l(),K(e(ue),{class:"px-4"},{default:$(()=>[u("div",Ae,[e(g).length?(l(),r(E,{key:1},[e(N).length?(l(),K(R,{key:1e3+m.value,title:"置顶","data-sources":e(N),onSelect:p,onDelete:a},null,8,["data-sources"])):f("",!0),e(G).length?(l(),K(R,{key:2e3+m.value,title:"应用分类组","data-sources":e(G),onSelect:p,onDelete:a},null,8,["data-sources"])):f("",!0),e(n).length?(l(),K(R,{key:3e3+m.value,title:"今天","data-sources":e(n),onSelect:p,onDelete:a},null,8,["data-sources"])):f("",!0),e(o).length?(l(),K(R,{key:4e3+m.value,title:"其他","data-sources":e(o),onSelect:p,onDelete:a},null,8,["data-sources"])):f("",!0)],64)):(l(),r("div",Ge,[s(e(d),{icon:"ri:inbox-line",class:"mb-2 text-3xl"}),u("span",null,A(t.$t("common.noData")),1)]))])]),_:1}))}}),Ne={class:"flex flex-col h-full flex-1 min-h-0"},Be={key:0,class:"flex h-14 items-center space-x-2 bg-[#fafbfc] dark:bg-[#18181c]"},Pe={class:"flex-1"},Ke={key:1,class:"flex h-14 items-center space-x-2 px-2 bg-[#fafbfc] dark:bg-[#18181c]"},Le={class:"flex-1"},ze={class:"flex-1 min-h-0 pb-4 overflow-hidden"},Ue={key:2,class:"px-6 py-2 flex items-center border-t dark:border-t-neutral-800"},Re={class:"p-4 border-t dark:border-t-neutral-800 flex flex-col"},Ee={key:0,class:"my-1 flex items-center select-none"},Ve={key:1,class:"my-1 flex items-center select-none"},qe={key:2,class:"my-1 flex items-center select-none"},We={key:3,class:"my-1 flex items-center select-none"},Fe={key:4,class:"my-1 flex items-center select-none"},je={key:5,class:"my-1 flex items-center select-none"},Oe={class:"flex justify-between my-3"},He=u("span",{class:"mr-2"},"公告栏",-1),Qe=u("span",{class:"mr-3"},"工作台",-1),Ye={class:"flex justify-betweenx"},Je=u("span",{class:"mr-3"},"清空全部非置顶会话",-1),st=V({__name:"index",setup(L){const w=de(),C=J(),x=X(),c=q(),h=Z();pe();const B=S(null),m=S(null),g=v(()=>h.userBalance),_=fe(),y=v(()=>c==null?void 0:c.activeModelKeyDeductType),D=v(()=>c==null?void 0:c.activeModelKeyPrice),N=S(0),G=S(0),n=S(0),o=S(0),p=S(!1),a=S(null);U(()=>h.userBalance.useModel3Token,(k,I)=>{var T;N.value=I||0,G.value=k||0,(T=B.value)==null||T.play()},{immediate:!0,flush:"post"}),U(()=>h.userBalance.useModel4Token,(k,I)=>{var T;n.value=I||0,o.value=k||0,(T=m.value)==null||T.play()},{immediate:!0,flush:"post"});const{isMobile:i}=Y(),t=S(!1),M=v(()=>x.siderCollapsed),z=S("");function W(k){z.value=k,c.setGroupKeyWord(k)}function ee(){p.value=!1}function te(){C.push("/role")}async function F(){try{t.value=!0,await c.addNewChatGroup(),await c.queryMyGroup(),t.value=!1,i.value&&x.setSiderCollapsed(!0)}catch{t.value=!1}}async function se(){_.warning({title:"清空分组",content:"是否删除所有非置顶的对话组？",positiveText:"确认删除",negativeText:"再想想",onPositiveClick:async()=>{await c.delAllGroup()}})}function j(){x.setSiderCollapsed(!M.value)}function oe(){p.value=!0,me(()=>{var k;(k=a.value)==null||k.focus()})}const le=v(()=>i.value?{position:"fixed",zIndex:50}:{}),ae=v(()=>i.value?{paddingBottom:"env(safe-area-inset-bottom)"}:{});return U(i,k=>{x.setSiderCollapsed(k)},{immediate:!0,flush:"post"}),(k,I)=>(l(),r("div",null,[s(e(ke),{collapsed:e(M),"collapsed-width":0,width:260,"show-trigger":e(i)?!1:"arrow-circle","collapse-mode":"transform",position:"absolute",bordered:"",style:O(e(le)),onUpdateCollapsed:j},{default:$(()=>[u("div",{class:"flex flex-col h-full bg-[#fafbfc] dark:bg-[#18181c]",style:O(e(ae))},[u("main",Ne,[p.value?(l(),r("div",Be,[s(e(P),{type:"primary",loading:t.value,onClick:F},{default:$(()=>[s(e(d),{icon:"ion:add-outline",class:"text-xl"})]),_:1},8,["loading"]),u("div",Pe,[s(e(Q),{modelValue:z.value,"onUpdate:modelValue":I[0]||(I[0]=T=>z.value=T),ref_key:"searchRef",ref:a,type:"text",placeholder:"对话历史查找",onBlur:ee,clearable:"",onInput:W},null,8,["modelValue"])])])):f("",!0),p.value?f("",!0):(l(),r("div",Ke,[u("div",Le,[s(e(P),{type:"primary",style:{width:"100%"},loading:t.value,onClick:F},{default:$(()=>[b(" 新对话 "),s(e(d),{icon:"ion:add-outline",class:"text-xl"})]),_:1},8,["loading"])]),s(e(P),{onClick:oe},{default:$(()=>[s(e(d),{icon:"icon-park-outline:search",class:"text-xl"})]),_:1})])),u("div",ze,[s(Me)]),e(i)?f("",!0):(l(),r("div",Ue,[u("div",{class:"flex items-center w-full p-1 mb-1 text-[#3076fd] rounded cursor-pointer transition hover:bg-[#eef0f3] dark:border-neutral-700 dark:hover:bg-[#33373c]",onClick:I[1]||(I[1]=T=>e(w).updateGoodsDialog(!0))},[s(e(d),{icon:"material-symbols:shopping-bag-outline",class:"mr-1 text-base"}),b(" 进入市场选购您的商品 ")])])),u("div",Re,[e(y)===1?(l(),r("div",Ee,[s(e(d),{icon:"material-symbols:account-balance-wallet-outline",class:"ml-2 mr-2 text-base"}),b("普通额度： "+A(`${e(g).sumModel3Count||0} 积分`),1)])):f("",!0),e(y)===1?(l(),r("div",Ve,[s(e(d),{icon:"ic:twotone-hourglass-top",class:"ml-2 mr-2 text-base"}),b(" 我已使用： "),s(e(H),{ref_key:"model3AnimationInstRef",ref:B,from:N.value,to:G.value},null,8,["from","to"]),b(" Token ")])):f("",!0),e(y)===1?(l(),r("div",qe,[s(e(d),{icon:"mingcute:bill-line",class:"ml-2 mr-2 text-base"}),b(" 模型费用： "+A(`${e(D)||0}积分 / 次对话`),1)])):f("",!0),e(y)===2?(l(),r("div",We,[s(e(d),{icon:"ic:twotone-hourglass-top",class:"ml-2 mr-2 text-base"}),b("我已使用： "),s(e(H),{ref_key:"model4AnimationInstRef",ref:m,from:n.value,to:o.value},null,8,["from","to"]),b(" Token ")])):f("",!0),e(y)===2?(l(),r("div",Fe,[s(e(d),{icon:"material-symbols:account-balance-wallet-outline",class:"ml-2 mr-2 text-base"}),b("高级额度： "+A(`${e(g).sumModel4Count||0} 积分`),1)])):f("",!0),e(y)===2?(l(),r("div",je,[s(e(d),{icon:"mingcute:bill-line",class:"ml-2 mr-2 text-base"}),b("模型费用： "+A(`${e(D)||0}积分 / 次对话`),1)])):f("",!0),u("div",Oe,[s(e(P),{type:"tertiary",size:"small",onClick:I[2]||(I[2]=T=>e(w).updateNoticeDialog(!0))},{default:$(()=>[s(e(d),{icon:"mdi:notice-board",class:"ml-2 mr-2 text-sm"}),He]),_:1}),s(e(P),{type:"tertiary",size:"small",onClick:te},{default:$(()=>[s(e(d),{icon:"ri:emoji-sticker-line",class:"ml-2 mr-2 text-sm"}),Qe]),_:1})]),u("div",Ye,[s(e(P),{type:"tertiary",size:"small",style:{width:"100%"},onClick:se},{default:$(()=>[s(e(d),{icon:"ant-design:delete-outlined",class:"ml-2 mr-2 text-sm"}),Je]),_:1})])])])],4)]),_:1},8,["collapsed","show-trigger","style"]),e(i)?ye((l(),r("div",{key:0,class:"fixed inset-0 z-40 bg-black/40",onClick:j},null,512)),[[he,!e(M)]]):f("",!0)]))}});export{st as _};
