
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{_ as oe}from"./index.vue_vue_type_script_setup_true_lang-DgN2PCOq.js";import{_ as ne}from"./index.vue_vue_type_script_setup_true_lang-CA9axw0k.js";import{I as b,d as se,m as S,r as c,p as ue,a as re,n,q as ie,g as A,c as Y,b as e,w as a,h as i,v as pe,x as de,F as me,s as ce,i as s,y as _e,z as I,t as V,e as k,D as fe,E as R,G as ye,j as ge,_ as ve,k as N}from"./index-B-LUCRde.js";import{u as B}from"./utcformatTime-Bq4gDWNx.js";import{d as we,Q as be}from"./index-J5zVJPyL.js";const x={queryAutoReply:p=>b.get("autoreply/query",{params:p}),delAutoReply:p=>b.post("autoreply/del",p),addAutoReply:p=>b.post("autoreply/add",p),updateAutoReply:p=>b.post("autoreply/update",p)},Ae=k("div",{class:"flex items-center gap-4"},"自定义回复说明",-1),Ve=k("div",{class:"text-sm/6"},[k("div",null,"当前可设置自定义回复，且可以多种关键词触发回复相同内容。")],-1),Re={class:"dialog-footer"},xe=se({__name:"autpReply",setup(p){const u=S({prompt:"",status:void 0,page:1,size:10}),m=c(!1),w=c(!1),g=c(0),U=c(0),$=c(),C=c(),r=S({status:0,prompt:"",answer:""}),O=S({status:[{required:!0,message:"请选择套餐类型",trigger:"change"}],prompt:[{required:!0,message:"请填写预设问题",trigger:"blur"}],answer:[{required:!0,message:"请填写回复答案",trigger:"blur"}]}),T=c([]);async function d(){try{w.value=!0;const o=await x.queryAutoReply(u),{rows:l,count:v}=o.data;w.value=!1,U.value=v,T.value=l}catch{w.value=!1}}async function j(o){await x.delAutoReply({id:o}),R.success("删除自定义问题成功"),await d()}function F(o){o==null||o.resetFields(),d()}function P(o){g.value=o.id;const{status:l,prompt:v,answer:h}=o;m.value=!0,ye(()=>{Object.assign(r,{status:l,prompt:v,answer:h})})}const D=ue(()=>g.value!==0);function K(o){o==null||o.resetFields(),g.value=0}async function Q(o){o==null||o.validate(async l=>{if(!l){R.warning("请按规则填写所有信息！");return}g.value===0?(await x.addAutoReply(r),R.success("添加自定义问题成功")):(await x.updateAutoReply({id:g.value,...r}),R.success("更新自定义问题成功")),m.value=!1,d()})}return re(()=>{d()}),(o,l)=>{const v=ge,h=ve,H=ne,z=n("el-input"),_=n("el-form-item"),L=n("el-option"),G=n("el-select"),f=n("el-button"),q=n("el-form"),M=oe,y=n("el-table-column"),J=n("el-tag"),W=n("el-popconfirm"),X=n("el-table"),Z=n("el-pagination"),E=n("el-row"),ee=n("el-switch"),te=n("el-dialog"),le=ie("loading");return A(),Y("div",null,[e(H,null,{title:a(()=>[Ae]),content:a(()=>[Ve]),default:a(()=>[e(h,{outline:"",onClick:l[0]||(l[0]=t=>m.value=!0)},{default:a(()=>[e(v,{name:"i-ri:file-text-line"}),i(" 添加新的自动回复 ")]),_:1})]),_:1}),e(M,null,{default:a(()=>[e(q,{ref_key:"formRef",ref:$,inline:!0,model:u},{default:a(()=>[e(_,{label:"自定义问题",prop:"prompt"},{default:a(()=>[e(z,{modelValue:u.prompt,"onUpdate:modelValue":l[1]||(l[1]=t=>u.prompt=t),placeholder:"自定义问题[模糊搜索]",onKeydown:pe(de(d,["prevent"]),["enter"])},null,8,["modelValue","onKeydown"])]),_:1}),e(_,{label:"问题启用状态",prop:"status"},{default:a(()=>[e(G,{modelValue:u.status,"onUpdate:modelValue":l[2]||(l[2]=t=>u.status=t),placeholder:"请选择问题启用状态",clearable:"",style:{width:"160px"}},{default:a(()=>[(A(!0),Y(me,null,ce(s(we),t=>(A(),I(L,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(_,null,{default:a(()=>[e(f,{type:"primary",onClick:d},{default:a(()=>[i(" 查询 ")]),_:1}),e(f,{onClick:l[3]||(l[3]=t=>F(s($)))},{default:a(()=>[i(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(M,{style:{width:"100%"}},{default:a(()=>[_e((A(),I(X,{border:"",data:s(T),style:{width:"100%"},size:"large"},{default:a(()=>[e(y,{prop:"prompt",label:"提问关键词"}),e(y,{prop:"answer",label:"回复答案"}),e(y,{prop:"status",label:"问题状态",width:"120"},{default:a(t=>[e(J,{type:t.row.status===1?"success":"danger"},{default:a(()=>[i(V(s(be)[t.row.status]),1)]),_:2},1032,["type"])]),_:1}),e(y,{prop:"createdAt",label:"创建时间",width:"200"},{default:a(t=>[i(V(s(B)(t.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),e(y,{prop:"updatedAt",label:"最后修改时间",width:"200"},{default:a(t=>[i(V(s(B)(t.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),e(y,{fixed:"right",label:"操作",width:"200"},{default:a(t=>[e(f,{link:"",type:"primary",size:"small",onClick:ae=>P(t.row)},{default:a(()=>[i(" 编辑 ")]),_:2},1032,["onClick"]),e(W,{"confirm-button-text":"确认删除","cancel-button-text":"放弃",type:"danger",width:"230px","icon-color":"red",title:"确定删除本条自动回复问题么？",onConfirm:ae=>j(t.row.id)},{reference:a(()=>[e(f,{link:"",type:"danger",size:"small"},{default:a(()=>[i(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[le,s(w)]]),e(E,{class:"mt-5 flex justify-end"},{default:a(()=>[e(Z,{"current-page":u.page,"onUpdate:currentPage":l[4]||(l[4]=t=>u.page=t),"page-size":u.size,"onUpdate:pageSize":l[5]||(l[5]=t=>u.size=t),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:s(U),onSizeChange:d,onCurrentChange:d},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),e(te,{modelValue:s(m),"onUpdate:modelValue":l[11]||(l[11]=t=>fe(m)?m.value=t:null),title:`${s(D)?"编辑":"添加"}自动回复问题`,width:"480",onClose:l[12]||(l[12]=t=>K(s(C)))},{footer:a(()=>[k("span",Re,[e(f,{onClick:l[9]||(l[9]=t=>m.value=!1)},{default:a(()=>[i("放弃生成")]),_:1}),e(f,{type:"primary",onClick:l[10]||(l[10]=t=>Q(s(C)))},{default:a(()=>[i(V(`${s(D)?"更新":"新增"}回复 `),1)]),_:1})])]),default:a(()=>[e(q,{ref_key:"formAutoReplyRef",ref:C,"label-position":"right","label-width":"80px",model:r,rules:O},{default:a(()=>[e(_,{label:"开启状态",prop:"status"},{default:a(()=>[e(ee,{modelValue:r.status,"onUpdate:modelValue":l[6]||(l[6]=t=>r.status=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),e(_,{label:"提问问题",prop:"prompt"},{default:a(()=>[e(z,{modelValue:r.prompt,"onUpdate:modelValue":l[7]||(l[7]=t=>r.prompt=t),type:"textarea",rows:5,placeholder:"请填写预设提问问题"},null,8,["modelValue"])]),_:1}),e(_,{label:"回复问题",prop:"answer"},{default:a(()=>[e(z,{modelValue:r.answer,"onUpdate:modelValue":l[8]||(l[8]=t=>r.answer=t),type:"textarea",rows:5,placeholder:"请填写预设回复答案"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});typeof N=="function"&&N(xe);export{xe as default};
